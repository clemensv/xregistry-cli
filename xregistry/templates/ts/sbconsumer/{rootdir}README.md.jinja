# {{ project_name }} Azure Service Bus Consumer

This project contains a TypeScript Azure Service Bus consumer generated from an xRegistry definition.

## Installation

```bash
npm install
```

## Building

```bash
npm run build
```

## Testing

```bash
npm test
```

## Usage

```typescript
import { ServiceBusClient } from '@azure/service-bus';
import { ServiceBusProcessor, {% for messagegroupid, messagegroup in root.messagegroups.items() -%}{%- set class_name = (messagegroupid | pascal | strip_namespace) + "EventDispatcher" %}{{ class_name }}{% if not loop.last %}, {% endif %}{% endfor %} } from './src';

const client = new ServiceBusClient('connection-string');

const dispatcher = new {% for messagegroupid, messagegroup in root.messagegroups.items() -%}{%- set class_name = (messagegroupid | pascal | strip_namespace) + "EventDispatcher" %}{{ class_name }}{% if loop.first %}{% endif %}{% endfor %}();
const processor = new ServiceBusProcessor(client);

// Register handlers
{% set ns = namespace(done=false) %}
{% for messagegroupid, messagegroup in root.messagegroups.items() if not ns.done -%}
{% set message_list = messagegroup.messages.items() | list %}
{% for messageid, message in message_list[:3] -%}
{%- set messagename = messageid | strip_namespace | pascal -%}
dispatcher.{{ messagename }}Handler = async (message, data) => {
    console.log('Received {{ messagename }}:', data);
};
{% endfor %}
{% set ns.done = true %}
{% endfor %}

processor.processMessage = async (message) => {
    await dispatcher.processMessage(message);
};

// For queue
await processor.startQueue('queue-name');

// OR for topic subscription
// await processor.startSubscription('topic-name', 'subscription-name');
```
