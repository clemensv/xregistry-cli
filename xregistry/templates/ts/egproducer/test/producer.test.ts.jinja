{%- import "cloudevents.jinja.include" as cloudEvents -%}
{%- import "util.jinja.include" as util -%}
// This code was generated by the xRegistry tool.
// Changes to this file may cause incorrect behavior and will be lost if the code is regenerated.

{%- set messagegroups = root.messagegroups %}

import * as {{ data_project_name }} from '../../{{ data_project_name }}/dist/index.js';
import { {% for messagegroupid, messagegroup in messagegroups.items() -%}{%- set class_name = (messagegroupid | pascal | strip_namespace) + "EventGridProducer" %}{{ class_name }}{% if not loop.last %}, {% endif %}{% endfor %} } from '../src';

const EVENT_GRID_ENDPOINT = process.env.EVENT_GRID_ENDPOINT || 'https://localhost.eventgrid.azure.net/api/events';
const EVENT_GRID_ACCESS_KEY = process.env.EVENT_GRID_ACCESS_KEY || 'test-key';

jest.setTimeout(60000);

{%- for messagegroupid, messagegroup in messagegroups.items() %}
{%- set pascal_group_name = messagegroupid | pascal %}
{%- set class_name = (pascal_group_name | strip_namespace) + "EventGridProducer" %}
{%- set test_class_name = (project_name | strip_dots | pascal) + (pascal_group_name | strip_dots) + "Tests" %}

describe('{{ test_class_name }}', () => {
    // Tests verify EventGrid producer class structure and method availability
    // For full integration testing with Event Grid, configure EVENT_GRID_ENDPOINT and EVENT_GRID_ACCESS_KEY environment variables
    
    {%- set message_list = messagegroup.messages.items() | list %}
    {%- for messageid, message in message_list[:3] %}
    {%- set messagename = messageid | strip_namespace | pascal %}
    {%- set body_type = util.body_type(data_project_name, root, message) %}
    
    test('should have {{ messagename }} EventGrid producer with send method', () => {
        // Verify producer class exists and has required methods
        expect({{ class_name }}).toBeDefined();
        expect({{ class_name }}.prototype.send{{ messagename }}).toBeDefined();
        
        // Verify producer can be instantiated
        const producer = new {{ class_name }}(EVENT_GRID_ENDPOINT, EVENT_GRID_ACCESS_KEY);
        expect(producer).toBeDefined();
        expect(producer.send{{ messagename }}).toBeDefined();
        
        // Note: Actual send test would require valid Event Grid credentials
        {%- if message.schemaurl %}
        {%- set schema = schemaobj(message.schemaurl) %}
        {%- if schema %}
        {%- if schema.type == "avro" %}
        {%- set avro_schema = schema.schema %}
        {%- for field in avro_schema.fields[:3] %}
        // Expected schema field: {{ field.name }}
        {%- endfor %}
        {%- elif schema.type == "json" %}
        {%- if schema.schema and schema.schema.properties %}
        {%- for propname, prop in (schema.schema.properties.items() | list)[:3] %}
        // Expected schema property: {{ propname }}
        {%- endfor %}
        {%- endif %}
        {%- endif %}
        {%- endif %}
        {%- endif %}
    });
    {%- endfor %}
});
{%- endfor %}
