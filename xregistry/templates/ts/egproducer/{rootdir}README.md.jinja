# {{ project_name }} Event Grid Producer

This project contains a TypeScript Azure Event Grid producer generated from an xRegistry definition.

## Installation

```bash
npm install
```

## Building

```bash
npm run build
```

## Testing

```bash
npm test
```

## Usage

### With Access Key

```typescript
import { {% for messagegroupid, messagegroup in root.messagegroups.items() -%}{%- set class_name = (messagegroupid | pascal | strip_namespace) + "EventGridProducer" %}{{ class_name }}{% if not loop.last %}, {% endif %}{% endfor %} } from './src';

const endpoint = 'https://<your-topic>.eventgrid.azure.net/api/events';
const accessKey = '<your-access-key>';

const producer = new {% for messagegroupid, messagegroup in root.messagegroups.items() -%}{%- set class_name = (messagegroupid | pascal | strip_namespace) + "EventGridProducer" %}{{ class_name }}{% if loop.first %}{% endif %}{% endfor %}(endpoint, accessKey);

// Send a single message
{% set ns = namespace(done=false) %}
{% for messagegroupid, messagegroup in root.messagegroups.items() if not ns.done -%}
{% set message_list = messagegroup.messages.items() | list %}
{% for messageid, message in message_list[:1] -%}
{%- set messagename = messageid | strip_namespace | pascal -%}
await producer.send{{ messagename }}({
    // your data here
});
{% endfor %}
{% set ns.done = true %}
{% endfor %}
```

### With Azure AD Authentication

```typescript
import { {% for messagegroupid, messagegroup in root.messagegroups.items() -%}{%- set class_name = (messagegroupid | pascal | strip_namespace) + "EventGridProducer" %}{{ class_name }}{% if not loop.last %}, {% endif %}{% endfor %} } from './src';

const endpoint = 'https://<your-topic>.eventgrid.azure.net/api/events';

const producer = new {% for messagegroupid, messagegroup in root.messagegroups.items() -%}{%- set class_name = (messagegroupid | pascal | strip_namespace) + "EventGridProducer" %}{{ class_name }}{% if loop.first %}{% endif %}{% endfor %}(endpoint);

// Send a single message
{% set ns = namespace(done=false) %}
{% for messagegroupid, messagegroup in root.messagegroups.items() if not ns.done -%}
{% set message_list = messagegroup.messages.items() | list %}
{% for messageid, message in message_list[:1] -%}
{%- set messagename = messageid | strip_namespace | pascal -%}
await producer.send{{ messagename }}({
    // your data here
});
{% endfor %}
{% set ns.done = true %}
{% endfor %}
```

### From Endpoint URL

```typescript
const endpointWithKey = 'https://<your-topic>.eventgrid.azure.net/api/events?api-key=<key>';
const producer = {% for messagegroupid, messagegroup in root.messagegroups.items() -%}{%- set class_name = (messagegroupid | pascal | strip_namespace) + "EventGridProducer" %}{{ class_name }}{% if loop.first %}{% endif %}{% endfor %}.createForEndpoint(endpointWithKey);
```
