{%- import "cloudevents.jinja.include" as cloudEvents -%}
{%- import "util.jinja.include" as util -%}
// This code was generated by the xRegistry tool.
// Changes to this file may cause incorrect behavior and will be lost if the code is regenerated.

import { EventHubProducerClient, EventHubConsumerClient } from '@azure/event-hubs';
{%- set messagegroups = root.messagegroups %}
{%- set uses_cloudevents_message = cloudEvents.usesCloudEvents(root) %}

import { {% for messagegroupid, messagegroup in messagegroups.items() -%}{%- set class_name = (messagegroupid | pascal | strip_namespace) + "Producer" %}{{ class_name }}{% if not loop.last %}, {% endif %}{% endfor %} } from '../src';
{%- if uses_cloudevents_message %}
import { CloudEvent } from 'cloudevents';
{%- endif %}

// Import data types (need to compile data project first: cd ../{{ data_project_name }} && npm install && npm run build)
// NOTE: In real usage, the data project should be a proper npm package dependency
import * as {{ data_project_name }} from '../../{{ data_project_name }}/dist/index.js';

// NOTE: These are stub tests that verify code generation and compilation.
// For full integration testing with Event Hubs, configure EVENTHUB_CONNECTION_STRING environment variable.

jest.setTimeout(10000);

{%- for messagegroupid, messagegroup in messagegroups.items() %}
{%- set pascal_group_name = messagegroupid | pascal %}
{%- set class_name = (pascal_group_name | strip_namespace) + "Producer" %}
{%- set test_class_name = (project_name | strip_dots | pascal) + (pascal_group_name | strip_dots) + "Tests" %}

describe('{{ test_class_name }}', () => {
    {%- set message_list = messagegroup.messages.items() | list %}
    {%- for messageid, message in message_list[:3] %}
    {%- set messagename = messageid | strip_namespace | pascal %}
    {%- set body_type = util.body_type(data_project_name, root, message) %}
    
    test('should compile {{ messagename }} send method', () => {
        // Stub test: verifies code generation and compilation
        // Real integration test would require Event Hubs connection
        const testData = {} as {{ body_type }};
        
        // Verify test data type is correct
        expect(testData).toBeDefined();
    });
    
    test('should compile {{ messagename }} batch send method', () => {
        const testData = [
            {} as {{ body_type }},
            {} as {{ body_type }}
        ];
        
        // Verify test data array structure is correct
        expect(testData).toHaveLength(2);
        expect(testData[0]).toBeDefined();
        expect(testData[1]).toBeDefined();
    });
    {%- endfor %}
});
{%- endfor %}
